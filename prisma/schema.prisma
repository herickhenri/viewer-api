// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Equipment {
  id          String                 @id @default(cuid())
  tag         String                 @unique
  name        String
  description String?
  photos      EquipmentPhoto[]
  panoramas   EquipmentsOnPanorama[]
  notes       Note[]

  @@map("equipaments")
}

model EquipmentPhoto {
  key          String    @id
  link         String    @unique
  equipment    Equipment @relation(fields: [equipment_id], references: [id], onDelete: Cascade)
  equipment_id String

  @@map("equipment_photos")
}

model Panorama {
  id         String                 @id @default(cuid())
  name       String
  images     PanoramaImage[]
  equipments EquipmentsOnPanorama[]
  links      Link[]
  notes      NotesOnPanoramas[]

  @@map("panoramas")
}

model PanoramaImage {
  key         String   @id
  link        String   @unique
  quality     Int
  panorama    Panorama @relation(fields: [panorama_id], references: [id], onDelete: Cascade)
  panorama_id String

  @@map("panorama_images")
}

model Note {
  id            String   @id
  created_at    DateTime
  description   String
  equipment_tag String
  author        String
  opportunity   Int

  equipment    Equipment?         @relation(fields: [equipment_id], references: [id])
  equipment_id String?
  panoramas    NotesOnPanoramas[]

  @@map("notes")
}

model Link {
  coord_x             Int
  coord_y             Int
  panorama_connect_id String

  panorama    Panorama @relation(fields: [panorama_id], references: [id], onDelete: Cascade)
  panorama_id String

  @@id([panorama_id, panorama_connect_id])
  @@map("links")
}

model EquipmentsOnPanorama {
  coord_x Int
  coord_y Int

  equipment    Equipment @relation(fields: [equipment_id], references: [id], onDelete: Cascade)
  equipment_id String

  panorama    Panorama @relation(fields: [panorama_id], references: [id], onDelete: Cascade)
  panorama_id String

  @@id([panorama_id, equipment_id])
}

model NotesOnPanoramas {
  coord_x Int
  coord_y Int

  note    Note   @relation(fields: [note_id], references: [id], onDelete: Cascade)
  note_id String

  panorama    Panorama @relation(fields: [panorama_id], references: [id], onDelete: Cascade)
  panorama_id String

  @@id([note_id, panorama_id])
}
